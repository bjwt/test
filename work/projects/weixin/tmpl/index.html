{% extends "base.html" %}
{% block title %} 首页 {% endblock %} 

{% autoescape on %}
{% block content %}
   <!-- query -->
<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=22ce688cdd542cbf1ec2673db43f6ccc"></script> 
<div id="container"></div>
<script type="text/javascript">
    var map = new AMap.Map("container", {
        resizeEnable: true
    });
    var placeSearch = new AMap.PlaceSearch();  //构造地点查询类
    //详情查询
    placeSearch.getDetails("B000A83U0P", function(status, result) {
        if (status === 'complete' && result.info === 'OK') {
            placeSearch_CallBack(result);
        }
    });
    var infoWindow = new AMap.InfoWindow({
        autoMove: true,
        offset: {x: 0, y: -30}
    });
    //回调函数
    function placeSearch_CallBack(data) {
        var poiArr = data.poiList.pois;
        //添加marker
        var marker = new AMap.Marker({
            map: map,
            position: poiArr[0].location
        });
        map.setCenter(marker.getPosition());     
        infoWindow.setContent(createContent(poiArr[0]));
		infoWindow.open(map, marker.getPosition());
    }
    function createContent(poi) {  //信息窗体内容
        var s = [];
        s.push("<b>名称：" + poi.name+"</b>");
        s.push("地址：" + poi.address);
        s.push("电话：" + poi.tel);
        s.push("类型：" + poi.type);
        return s.join("<br>");
    }
</script>
   <table align="center">
      <tr>
         <td>
            <form action="/query" method="post" class="form-search">
               {% csrf_token %}
               <input type="text" name="productname" class="input-medium search-query"/>
               <input type="submit" value="查询" class="btn"/>
            </form>      
         </td>
      </tr>
   </table>
   <div class="row-fluid">
      {%include "pagenav.html"%}
   </div>
    <div class="row-fluid">
      <table align="center" class="table table-striped">
         <tbody>   
            {% for  product in page.object_list %}   
               <tr>
                  <th>
                     <img src="{{MEDIA_URL}}{{product.img}}" class="img-polaroid"  align="right"/>
                  </th>
                  
                  <th>
                     <h4>{{product.name}}</h4>
                     分　　类：{{product.ptype.name}}<br/>
                     定　　价：{{product.pric}}<br/>
                     <a href="/order/buy/{{product.id}}" class="btn btn-primary btn-small">
                     <i class="icon-shopping-cart"></i>订购</a>
                  </th>           
               </tr>
            {% endfor%}
         </tbody>
      </table>
   </div><!--  -->
   <div class="row-fluid">
      {%include "pagenav.html"%}
   </div>
{%endblock%}
{% endautoescape %}
